 <% layout("/layouts/boilerplate") %>

<div class="container py-4">

  <!-- TITLE -->
  <!-- <h1 class="fw-bold mb-4 text-center"><//%= listing.title %></h1> -->

<div class="d-flex justify-content-center align-items-center gap-3 mb-4">
  <h1 class="fw-bold m-0"><%= listing.title %></h1>

  <% if(currUser){ %>
    <form action="/listings/<%= listing._id %>/wishlist" method="POST">
      <button type="submit" style="border:none; background:none; font-size:26px; cursor:pointer;">
        
        <% if(currUser.wishlist && currUser.wishlist.includes(listing._id.toString())) { %>
          <!-- Filled Heart -->
          <i class="fa-solid fa-heart text-danger"></i>
        <% } else { %>
          <!-- Empty Heart -->
          <i class="fa-regular fa-heart text-danger"></i>
        <% } %>

      </button>
    </form>
  <% } %>
</div>



  <!-- IMAGE + INFO -->
  <div class="mx-auto" style="max-width: 900px;">
    <div class="card show-card listing-card border-0 shadow-sm">

      <img src="<%= listing.image.url %>" class="card-img-top show-img" alt="listing_image">

      <div class="card-body p-4">

        <p class="text-muted mb-2">
          Hosted by <span class="fw-semibold">@<%= listing.owner.username %></span>
        </p>

        <p class="mb-3"><%= listing.description %></p>

        <h4 class="fw-bold mb-3 text-danger">
          â‚¹ <%= listing.price?.toLocaleString("en-IN") || "N/A" %> / night
        </h4>

        <p class="mb-1"><%= listing.location %></p>
        <p class="text-muted"><%= listing.country %></p>

      </div>
    </div>
  </div>

  <!-- EDIT DELETE -->
  <% if(currUser && currUser._id.equals(listing.owner._id)){ %>
    <div class="d-flex justify-content-center gap-3 mt-4">
      <a href="/listings/<%= listing._id %>/edit" class="btn btn-danger px-4">
        Edit
      </a>

      <form action="/listings/<%= listing._id %>?_method=DELETE" method="POST">
        <button class="btn btn-dark px-4">Delete</button>
      </form>
    </div>
  <% } %>

  <!-- REVIEW FORM -->
  <% if(currUser) { %>
    <div class="mx-auto mt-5" style="max-width: 800px;">
      <div class="card border-0 shadow-sm rounded-4">
        <div class="card-body p-4">

          <h4 class="mb-3">Leave a Review</h4>

          <form action="/listings/<%= listing._id %>/reviews" method="post" novalidate class="needs-validation">

            <div class="mb-3">
              <label class="form-label">Rating</label>
              <input type="range" min="1" max="5" name="review[rating]" class="form-range">
            </div>

            <div class="mb-3">
              <label class="form-label">Comments</label>
              <textarea name="review[comment]" rows="4" class="form-control" required></textarea>
              <div class="invalid-feedback">please add some comment</div>
            </div>

            <button class="btn btn-dark">Submit Review</button>
          </form>

        </div>
      </div>
    </div>
  <% } %>

  <!-- ALL REVIEWS -->
<div style="overflow-x: hidden;">
  <p class="mt-4 fw-bold">All Reviews</p>

  <div class="row mt-2">
    <% for(review of listing.reviews) { %>
      <div class="col-md-6 mb-3">
        <div class="card h-100 shadow-sm">
          <div class="card-body">
            <h6 class="card-title mb-1">@<%= review.author.username %></h6>
            <p class="card-text mb-2"><%= review.comment %></p>
            <small class="text-muted">Rating: <%= review.rating %> / 5</small>
          </div>

          <% if(currUser && review.author._id.equals(currUser._id)) { %>
            <form class="p-2 pt-0"
              action="/listings/<%=listing._id%>/reviews/<%=review._id%>?_method=DELETE"
              method="post">
              <button class="btn btn-sm btn-dark">Delete</button>
            </form>
          <% } %>

        </div>
      </div>
    <% } %>
  </div>
</div>


 

